# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Theme Overview

**wohnegruen** is a custom WordPress theme for a mobile homes company. It uses **ACF Pro** with a Gutenberg block-based architecture. There is **no build system** - all CSS/JS files are served directly without compilation.

## Architecture

### ACF Block System (Primary Architecture)

The theme is built around  custom ACF blocks registered in `inc/acf.php` (1,318 lines). Each block follows this pattern:

```
inc/acf.php                           → Block registration + field definitions
template-parts/blocks/block-name.php  → Block template rendering
```

**Critical Pattern:** Blocks use `get_field()` directly on block context, NOT page context. Fields are scoped to the block instance, not the page.

**10 Registered Blocks:**
- `wohnegruen-hero` - Hero section with CTA buttons
- `wohnegruen-features` - Feature grid with icons
- `wohnegruen-models` - Model showcase (can pull from CPT or manual)
- `wohnegruen-about` - Company info section
- `wohnegruen-contact` - Contact form + info
- `wohnegruen-gallery` - Filterable image gallery with lightbox
- `wohnegruen-3d-tour` - Video/Matterport 3D tours
- `wohnegruen-floor-plans` - Floor plan showcase
- `wohnegruen-interiors` - Interior design showcase
- `wohnegruen-cta` - Call-to-action banner

### File Structure

```
inc/
├── theme.php           # Theme setup, nav menus, helper functions
├── enqueue.php         # Asset enqueuing (CSS/JS)
├── acf.php            # ACF block registration + field groups (LARGE FILE)
└── cpt/
    └── cpt-mobilhaus.php  # Custom Post Type: Mobilhaus (mobile homes)

template-parts/blocks/  # 10 ACF block templates
assets/
├── css/
│   ├── style.css       # Main stylesheet with CSS variables
│   ├── main.css        # Animations and utilities
│   └── blocks.css      # Block-specific styles
└── js/
    └── main.js         # Vanilla JS (hamburger, lightbox, animations)
```

### Custom Post Type: Mobilhaus

**Slug:** `modeli` (archive at `/modeli/`)
**Single:** `mobilhaus` (URLs like `/modeli/alpin-kompakt/`)

**Key Fields:**
- `model_size`, `model_rooms`, `model_persons`, `model_price`
- `model_features` (repeater), `model_specifications` (repeater)

Used by the Models block to pull dynamic content when `models_source = 'cpt'`.

### ACF Options Pages

Global settings stored in ACF options pages:
- **Navigation:** Logo, CTA button, phone number
- **Footer:** Description, footer links, copyright
- **Contact:** Phone, email, address, business hours

Access via: `wohnegruen_get_option('field_name', 'default')`

### Helper Functions (`inc/theme.php`)

```php
wohnegruen_get_field($field_name, $post_id, $default)  // ACF field with fallback
wohnegruen_get_option($field_name, $default)           // ACF option with fallback
wohnegruen_get_icon($icon_name)                        // SVG icon rendering
```

**Available Icons:** phone, email, location, clock, check, arrow-right, home, size, rooms, users, shield, star, truck, tools, leaf, play, cube, expand, grid

### CSS Architecture

**CSS Variables System** (in `style.css`):
```css
--color-primary: hsl(142 52% 36%)      /* Green */
--color-primary-light: hsl(142 52% 50%)
--color-primary-dark: hsl(142 52% 20%)
--color-background: hsl(60, 20%, 98%)  /* Off-white */
--font-heading: 'Outfit'
--font-body: 'DM Sans'
--radius: 0.75rem
--transition: all 0.3s ease
```

**Responsive Breakpoints:**
- Mobile: `max-width: 767px`
- Tablet: `min-width: 768px`
- Desktop: `min-width: 1024px`

### JavaScript Features (`assets/js/main.js`)

- Hamburger menu toggle (mobile navigation)
- Smooth scroll for anchor links
- Navigation scroll state (add background on scroll Y > 100)
- Intersection Observer for scroll animations
- Gallery filtering and lightbox with keyboard navigation
- Form validation (basic)

## Development Workflow

### No Build System

This theme has **no npm, webpack, or build process**. To modify:

1. **Edit CSS directly** in `style.css`, `main.css`, or `blocks.css`
2. **Edit JS directly** in `assets/js/main.js`
3. **Refresh browser** - changes are immediate

### Adding a New ACF Block

1. Register block in `inc/acf.php`:
   ```php
   acf_register_block_type(array(
       'name'              => 'wohnegruen-newblock',
       'title'             => __('New Block', 'wohnegruen'),
       'render_template'   => 'template-parts/blocks/block-newblock.php',
       'category'          => 'wohnegruen',
       'icon'              => 'admin-home',
       'supports'          => array('align' => array('full', 'wide'), 'anchor' => true),
   ));
   ```

2. Define field group in `inc/acf.php`:
   ```php
   acf_add_local_field_group(array(
       'key' => 'group_block_newblock',
       'title' => 'New Block',
       'location' => array(array(array(
           'param' => 'block',
           'operator' => '==',
           'value' => 'acf/wohnegruen-newblock',
       ))),
       'fields' => array(/* field definitions */),
   ));
   ```

3. Create template in `template-parts/blocks/block-newblock.php`:
   ```php
   <?php
   $block_id = isset($block['anchor']) ? $block['anchor'] : 'block-' . $block['id'];
   $title = get_field('title');
   ?>
   <section id="<?php echo esc_attr($block_id); ?>" class="newblock-section">
       <h2><?php echo esc_html($title); ?></h2>
   </section>
   ```

### Working with front-page.php

**IMPORTANT:** The current `front-page.php` (521 lines) uses **hardcoded ACF page fields**, NOT blocks. It pulls fields directly with `get_field()` on the page context.

If converting to Gutenberg blocks:
1. Replace content with `the_content()` to render blocks
2. Add blocks via WordPress admin Gutenberg editor
3. Populate block fields in the block inspector

### Language Considerations

**Current State:** Mixed Slovenian/German
- Admin labels: Slovenian (`inc/acf.php`, `inc/cpt/cpt-mobilhaus.php`)
- Frontend defaults: Some German, some Slovenian
- Text domain: `wohnegruen`

When translating:
- ACF field labels in `inc/acf.php` (lines 253-1318)
- CPT labels in `inc/cpt/cpt-mobilhaus.php` (lines 13-25)
- Block template defaults in `template-parts/blocks/*.php`
- Page template content in `page-*.php` files

## WordPress Admin

### ACF Options Pages Structure

```
wohnegruen Settings (main menu, position 2)
├── Navigation (logo, CTA, phone)
├── Footer (description, links, copyright)
└── Kontakt (phone, email, address, hours)
```

### Custom Post Type Menu

```
Mobilne Hiške (position 5)
├── Add New
├── Categories (none registered)
└── Tags (none registered)
```

## Important Patterns & Conventions

### Data Source Flexibility

The **Models block** supports two data sources:
- `models_source = 'cpt'` → Query from Mobilhaus CPT
- `models_source = 'manual'` → Use manually entered repeater fields

This pattern can be extended to other blocks needing dynamic/static content.

### Fallback Content

Every block provides fallback content if ACF fields are empty:
```php
$title = get_field('title') ?: 'Default Title';
$items = get_field('items') ?: array(/* default items */);
```

### Security & Escaping

Always escape output:
```php
echo esc_html($text);           // Plain text
echo esc_url($url);             // URLs
echo esc_attr($attribute);      // HTML attributes
echo wp_kses_post($rich_text);  // Rich text/HTML
```

### Responsive Images

Use WordPress image sizes:
```php
$image = get_field('image');
echo wp_get_attachment_image($image['ID'], 'large');
```

## Common Development Tasks

### Modifying Navigation

Navigation settings: **WP Admin → wohnegruen Settings → Navigation**
- Logo: ACF field `nav_logo`
- CTA button: `nav_cta_text`, `nav_cta_link`
- Access via: `wohnegruen_get_option('nav_logo')`

### Modifying Footer

Footer settings: **WP Admin → wohnegruen Settings → Footer**
- Access via: `wohnegruen_get_option('footer_description')`
- Template: `footer.php` (lines 16-113)

### Adding SVG Icons

Add to `wohnegruen_get_icon()` function in `inc/theme.php`:
```php
case 'new-icon':
    return '<svg>...</svg>';
```

Then use: `<?php echo wohnegruen_get_icon('new-icon'); ?>`

### Customizing Mobile Menu

Mobile menu structure:
- Trigger: `.hamburger` button in `header.php` (lines 62-67)
- Menu: `.mobile-menu` overlay (lines 71-93)
- JavaScript: `main.js` (lines 6-27)
- CSS: `style.css` (lines 378-467)

### Gallery Lightbox Customization

Lightbox code: `main.js` (lines 118-257)
Lightbox styles: `style.css` (lines 1486-1584)

Features:
- Click to open full image
- Prev/Next navigation
- Keyboard controls (Esc, Arrow keys)
- Counter display

## Git Workflow

Current branch: `main`

When making significant changes:
```bash
# Create backup commit
git add -A
git commit -m "Backup before [change description]"

# Make changes, then commit with descriptive message
git commit -m "Feature: Add new block for testimonials

- Register wohnegruen-testimonials block
- Create template in template-parts/blocks/
- Add ACF field group for testimonial data
- Style testimonial cards with grid layout"

# Push changes
git push origin main
```

## Testing Checklist

Before committing major changes:

**Block Rendering:**
- [ ] Block displays correctly in Gutenberg editor preview
- [ ] All ACF fields save and load properly
- [ ] Fallback content shows when fields are empty
- [ ] Block renders on frontend without errors

**Responsive Design:**
- [ ] Desktop (1920px+)
- [ ] Tablet (768px - 1024px)
- [ ] Mobile (< 768px)
- [ ] Hamburger menu functions on mobile

**Browser Testing:**
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

**WordPress Admin:**
- [ ] Block appears in Gutenberg inserter
- [ ] Fields are properly labeled in inspector
- [ ] Conditional logic works (if used)
- [ ] Preview mode functions correctly

## Known Limitations & Considerations

1. **No Automated Testing** - Manual testing required for all changes
2. **No Build Pipeline** - CSS/JS served directly, no minification
3. **No Composer/npm** - All dependencies are WordPress core or ACF Pro
4. **Mixed Language** - Admin interface is Slovenian, frontend content mixed
5. **No Caching Strategy** - Consider adding object caching for production
6. **Limited Form Validation** - Client-side only, no server-side validation
7. **Hardcoded Front Page** - `front-page.php` uses direct ACF fields, not blocks

## Performance Considerations

**CSS Variables:** All theme colors use HSL format with CSS variables for easy customization and theming.

**JavaScript:** Vanilla JS with no jQuery dependency. Use Intersection Observer for scroll animations (efficient, performant).

**Images:** Use WordPress image sizes. Recommended sizes:
- Thumbnail: 150x150
- Medium: 300x300
- Large: 1024x1024
- Full: Original

**Lazy Loading:** WordPress native lazy loading enabled for images.

## Debugging

**Enable WordPress Debug Mode:**
Add to `wp-config.php`:
```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

**Check error logs:** `wp-content/debug.log`

**ACF Field Debugging:**
```php
// Dump all fields for current block
echo '<pre>';
print_r(get_fields());
echo '</pre>';
```

**JavaScript Console:**
Use `console.log()` liberally. Check `wohnegruenData` object for available data.

## References

- **WordPress Theme Handbook:** https://developer.wordpress.org/themes/
- **ACF Documentation:** https://www.advancedcustomfields.com/resources/
- **ACF Blocks Tutorial:** https://www.advancedcustomfields.com/resources/blocks/
